# HLT-TC-004: Service Bundle Selection during Onboarding

**Version:** 1.0
**Date:** May 17, 2025
**Author:** AI Assistant (Gemini)

## 1. Test Overview
This High-Level Test (HLT) verifies that a new user, after providing POPIA consent during onboarding, can successfully select a service bundle, and this choice is recorded and reflected in their accessible features.

## 2. User Story / Scenario
*   **User Story (PRD 4.1):** *As a user, I want to be able to choose a "Street-Vendor CRM" bundle upon setup so I can immediately access relevant tools for my business.*
*   **Feature (PRD 5.1):** Service Bundle Selection: Users can choose pre-defined "bundles" of features (e.g., Street-Vendor CRM).
*   **Scenario (PRD 6.3 Onboarding Flow):** ... Bot replies in detected language (or default) -> User selects a free "bundle" -> Chat commands trigger background workflows.

## 3. Preconditions
*   The test user has successfully completed the initial onboarding steps: QR code scan, phone pairing, language detection (e.g., English), POPIA notice presentation, and POPIA consent given.
*   The system is at the stage of presenting service bundle options to the user.
*   At least two service bundles are configured in the system (e.g., "Street-Vendor CRM" and "Community Info") with distinct features/commands. Bundle options are available in the user's current language (English).
*   The Supabase database schema supports storing the user's selected service bundle.

## 4. Test Steps

| Step | User Action (via WhatsApp)                                     | Expected System Response (WhatsApp Message & Backend)                                                                                                                                                                                                                                                                                                                                 | AI Verifiable Checks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| :--- | :------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | System presents bundle options (e.g., "1. Street-Vendor CRM", "2. Community Info. Please reply with the number of your choice.") | User is observing the options presented.                                                                                                                                                                                                                                                                                              | WhatsApp message received contains the expected bundle options in English.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 2    | User sends: "1" (to select "Street-Vendor CRM")                | **System (WhatsApp):** Responds with a confirmation in English (e.g., "You have selected the Street-Vendor CRM bundle. You can now use commands like 'Log Sale' or 'Log Expense'. Type 'Help' for more commands.").<br>**System (Backend):** Records "Street-Vendor CRM" (or its identifier) as the user's selected bundle in the Supabase database. Logs the bundle selection event. | WhatsApp response confirms selection of "Street-Vendor CRM" and provides relevant next steps/commands in English. Supabase query verifies the user's `selected_bundle` field is updated to "Street-Vendor CRM" (or its ID). Backend logs show the bundle selection event.                                                                                                                                                                                                                                                                                                          |
| 3    | User attempts to use a command specific to the selected bundle, e.g., "Log Sale 50 Apples" | **System (WhatsApp):** Responds appropriately to the "Log Sale" command (e.g., "Sale of 50 Apples logged successfully.").\<br>**System (Backend):** Processes the "Log Sale" command, as it's part of the "Street-Vendor CRM" bundle.                                                                                                                               | WhatsApp response indicates successful processing of the bundle-specific command. Supabase database shows the sale logged for the user. Backend logs confirm command processed successfully.                                                                                                                                                                                                                                                                                                                                                                                                        |
| 4    | User attempts to use a command *not* in the selected bundle (e.g., a hypothetical "Advanced Accounting Report" command from a premium bundle) | **System (WhatsApp):** Responds with a message indicating the command is not available for their current bundle (e.g., "Sorry, the 'Advanced Accounting Report' feature is not part of your current bundle. You can explore other bundles by typing '/bundles'.").<br>**System (Backend):** Recognizes the command but identifies it as outside the user's entitled features. | WhatsApp response indicates the command is unavailable for the current bundle, in English. Backend logs show the command was recognized but access was denied due to bundle restrictions. No advanced accounting report is generated.                                                                                                                                                                                                                                                                                                                                                     |
| 5    | (Scenario for a different user or after reset) User is presented with bundle options again. User sends: "2" (to select "Community Info") | **System (WhatsApp):** Responds with a confirmation in English (e.g., "You have selected the Community Info bundle. You can now ask for 'Directions' or 'Local News'.").<br>**System (Backend):** Records "Community Info" as the user's selected bundle.                                                                                                                            | WhatsApp response confirms selection of "Community Info". Supabase query verifies `selected_bundle` is "Community Info".                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 6    | User attempts command specific to "Community Info", e.g., "Directions to Library" | **System (WhatsApp):** Responds appropriately (e.g., "Directions to Library: ...").<br>**System (Backend):** Processes the command.                                                                                                                                                                                                                                            | WhatsApp response provides directions. Backend logs confirm command processed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 7    | User attempts command specific to "Street-Vendor CRM", e.g., "Log Sale 10 Bread" | **System (WhatsApp):** Responds with a message indicating command is not available for "Community Info" bundle.<br>**System (Backend):** Recognizes command, denies access.                                                                                                                                                                                                  | WhatsApp response indicates command is unavailable. Backend logs show access denied. No sale logged.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

## 5. Acceptance Criteria
*   **AC-01:** The system correctly records the user's selected service bundle in the Supabase database.
    *   **AI Verifiable:** Supabase query confirms the `selected_bundle` field for the user matches their choice.
*   **AC-02:** The system sends a confirmation message to the user in their current language after they select a bundle.
    *   **AI Verifiable:** WhatsApp response content and language match the expected confirmation for the selected bundle.
*   **AC-03:** The user can successfully access and use features/commands included in their selected service bundle.
    *   **AI Verifiable:** System correctly processes commands specific to the selected bundle. Backend logs and database state (e.g., logged sale) confirm successful execution.
*   **AC-04:** The user is appropriately restricted from accessing features/commands not included in their selected service bundle.
    *   **AI Verifiable:** System responds with a "feature not available" message (or similar) when the user attempts a command outside their bundle. Backend logs show access denial. No unintended action occurs.
*   **AC-05:** The bundle selection interaction is data-efficient (≤5KB per interaction).
    *   **AI Verifiable:** Network monitoring tool output (or payload size calculation) for each step shows data ≤5KB.

## 6. Dependencies & Assumptions
*   Service bundles, their associated features/commands, and corresponding confirmation messages are correctly defined and configured in the system.
*   The system has a mechanism to check a user's entitlements based on their selected bundle before executing a command.
*   User's language preference is correctly set prior to bundle selection.

## 7. References
*   PRD Section: 4.1 (User Onboarding & Setup - Bundle Selection), 5.1 (Account Management & Onboarding - Service Bundle Selection).
*   High-Level Test Strategy Report Section: 4.1 (User Onboarding & Account Management).
*   Master Acceptance Test Plan: HLT-TC-004.