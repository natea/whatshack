# HLT-TC-007: Sales Logging

**Version:** 1.0
**Date:** May 17, 2025
**Author:** AI Assistant (Gemini)

## 1. Test Overview
This High-Level Test (HLT) verifies that an SME user can successfully log a sales transaction using a simple command via Township Connect.

## 2. User Story / Scenario
*   **User Story (PRD 4.2):** *As a street vendor, after making a sale, I want to easily log "Sale 75 sweets" so I can keep track of my income through WhatsApp.*
*   **Feature (PRD 5.2):** Sales Logging: Simple command to log sales transactions.
*   **Scenario (HLT Strategy 4.2):** A street vendor logs a sale. Vendor sends "Sale 75 sweets", system confirms and logs the sale.

## 3. Preconditions
*   The test user is an onboarded SME user with a service bundle that includes sales logging (e.g., "Street-Vendor CRM").
*   User's language is set (e.g., English).
*   The system is configured to parse commands like "Sale [amount] [description]".
*   The Supabase database has a table (e.g., `transactions` or `sales_log`) to store sales records, linked to user IDs.

## 4. Test Steps

| Step | User Action (via WhatsApp)        | Expected System Response (WhatsApp Message & Backend)                                                                                                                                                                                                                                                                                                                             | AI Verifiable Checks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| :--- | :-------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | User sends: "Sale 75 sweets"      | **System (WhatsApp):** Responds with a confirmation message in English (e.g., "Sale of R75.00 for 'sweets' logged successfully." or "Got it! Sale: R75.00 - sweets.").\<br>**System (Backend):** Parses the command, extracts amount (75) and description ("sweets"). Creates a new sales record in the Supabase database associated with the user, including amount, description, and timestamp. | WhatsApp response received matches an expected confirmation format for sales logging, including the amount and description. Supabase query on the `sales_log` (or `transactions` with type 'sale') table verifies a new record exists for the current user with: `amount = 75.00`, `description = "sweets"`, `transaction_type = "sale"`, and a recent `timestamp`. Backend logs show successful parsing and database insertion.                                                                                                                                                                                                                                                                                                                                                     |
| 2    | User sends: "Sale 120.50 apples and bananas" | **System (WhatsApp):** Confirms logging (e.g., "Sale of R120.50 for 'apples and bananas' logged.").\<br>**System (Backend):** Parses amount (120.50) and description ("apples and bananas"). Logs to Supabase.                                                                                                                                                                    | Similar to Step 1. Supabase record shows `amount = 120.50`, `description = "apples and bananas"`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 3    | User sends: "Sale sweets 75" (alternative valid format, if supported) | **System (WhatsApp):** (If supported) Confirms logging (e.g., "Sale of R75.00 for 'sweets' logged.").\<br>**System (Backend):** (If supported) Parses amount and description correctly. Logs to Supabase.                                                                                                                                                            | (If this alternative format is supported by design) Similar to Step 1. Supabase record shows `amount = 75.00`, `description = "sweets"`. If not supported, this should follow Step 4/5 error handling.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 4    | User sends: "Sale seventy-five sweets" (invalid amount format) | **System (WhatsApp):** Responds with an error message in English (e.g., "Sorry, 'seventy-five' is not a valid amount for a sale. Please use numbers like 75 or 120.50.").\<br>**System (Backend):** Logs failed attempt. No database record created.                                                                                                                            | WhatsApp response matches expected error for invalid amount. No new sales record in Supabase for this attempt. Backend logs show parsing error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 5    | User sends: "Sale 75" (missing description, if description is mandatory) | **System (WhatsApp):** (If description mandatory) Responds with an error message (e.g., "Please provide a description for your sale, like 'Sale 75 sweets'.").<br>**System (Backend):** Logs failed attempt. No database record.                                                                                                                                                | (If description mandatory) WhatsApp response matches expected error for missing description. No new sales record. If description is optional, this step should behave like Step 1 but with a null/empty description in Supabase. Test based on system design.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 6    | User sends: "Log Sale 50 Coke" (variation of command keyword, if "Log Sale" is also accepted) | **System (WhatsApp):** (If "Log Sale" is accepted) Confirms logging (e.g., "Sale of R50.00 for 'Coke' logged.").\<br>**System (Backend):** Parses and logs.                                                                                                                                                                                                     | (If "Log Sale" is accepted) Similar to Step 1. Supabase record for `amount = 50.00`, `description = "Coke"`. If only "Sale" is accepted, this should be an unrecognized command error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

## 5. Acceptance Criteria
*   **AC-01:** The system successfully logs a sales transaction with a valid amount and description when a user provides a correct "Sale [amount] [description]" command.
    *   **AI Verifiable:** Supabase query confirms a new record in the sales log table with the correct `user_id`, `amount`, `description`, `transaction_type` ('sale'), and `timestamp`.
*   **AC-02:** The system sends a confirmation message to the user in their current language after successfully logging a sale.
    *   **AI Verifiable:** WhatsApp response content matches an expected confirmation format, including the logged amount and description.
*   **AC-03:** The system correctly parses numeric amounts (including decimals) and multi-word descriptions.
    *   **AI Verifiable:** Supabase records for test cases like "Sale 120.50 apples and bananas" show `amount = 120.50` and `description = "apples and bananas"`.
*   **AC-04:** The system provides clear error messages in the user's language for invalid amount formats or missing mandatory information (if any, like amount).
    *   **AI Verifiable:** WhatsApp responses match predefined error messages. No incorrect sales record is created in Supabase for failed attempts (or logged as 'failed' with a reason).
*   **AC-05:** The sales logging interaction is data-efficient (≤5KB per interaction).
    *   **AI Verifiable:** Network monitoring tool output (or payload size calculation) for each step shows data ≤5KB.

## 6. Dependencies & Assumptions
*   The command parsing logic for "Sale [amount] [description]" (and any supported variations) is robust.
*   The Supabase table for sales logging is correctly set up with appropriate fields and data types.
*   The user has the necessary permissions/bundle to use the sales logging feature.

## 7. References
*   PRD Section: 4.2 (Business & Finance - Sales Logging), 5.2 (Business & Finance Tools - Sales Logging).
*   High-Level Test Strategy Report Section: 4.2 (Core Business Functionality - Sales Logging).
*   Master Acceptance Test Plan: HLT-TC-007.